task registerClient {
    println "Register Client in API Manager .."

    def clientRegJsonFile = file('api-handler/client-register.json')
    def parsedJson = new groovy.json.JsonSlurper().parseText(clientRegJsonFile.text)

    def clientRegpayload = new groovy.json.JsonBuilder(parsedJson).toString()

    def contentType = "Content-Type: application/json"
    def authorization = "Authorization: Basic YWRtaW46YWRtaW4="
    def url = "${apimServer}/client-registration/v0.14/register"
    def type = "POST"

    def clientRegResponse = runCurl(type,contentType,authorization,url,clientRegpayload)

    def parsedResponse =  new groovy.json.JsonSlurper().parseText(clientRegResponse)

    def clientId =  parsedResponse.clientId
    def clientSecret =   parsedResponse.clientSecret

    //client-id:client-secret
    def encodingString = "${clientId}:${clientSecret}"
    project.ext.encodedString = encodeBase64(encodingString)
}

ext{
    basicAuthCode = project.ext.encodedString
}
